import telebot
from telebot.types import ReplyKeyboardMarkup, KeyboardButton

bot = telebot.TeleBot("8015227740:AAGst8KADaABbHlX3yQ6azDQzbEhUIxzU3s")

admin_chat_id = 810929551

user_data = {}


@bot.message_handler(commands=['start'])
def start(message):
    markup = ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(KeyboardButton("üìù –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑"))
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ üëá", reply_markup=markup)


@bot.message_handler(func=lambda message: message.text == "üìù –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑")
def ask_name(message):
    user_data[message.chat.id] = {}
    bot.send_message(message.chat.id, "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?")
    bot.register_next_step_handler(message, ask_type)


def ask_type(message):
    user_data[message.chat.id]["name"] = message.text
    bot.send_message(message.chat.id, "–ö–∞–∫–æ–π –≤–∏–¥ —Ä–µ–∫–ª–∞–º—ã –≤–∞–º –Ω—É–∂–µ–Ω?")
    bot.register_next_step_handler(message, ask_description)


def ask_description(message):
    user_data[message.chat.id]["type"] = message.text
    bot.send_message(message.chat.id, "–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.")
    bot.register_next_step_handler(message, ask_photo)


def ask_photo(message):
    user_data[message.chat.id]["description"] = message.text
    bot.send_message(message.chat.id, "–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ. –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ ¬´–Ω–µ—Ç¬ª.")
    bot.register_next_step_handler(message, finish_order)


def finish_order(message):
    chat_id = message.chat.id
    name = user_data[chat_id]["name"]
    ad_type = user_data[chat_id]["type"]
    desc = user_data[chat_id]["description"]

    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    tg_name = message.from_user.username or "–Ω–µ—Ç username"
    full_name = f"{message.from_user.first_name or ''} {message.from_user.last_name or ''}".strip()
    user_id = message.from_user.id

    text = (
        f"üì• –ù–æ–≤—ã–π –∑–∞–∫–∞–∑!\n\n"
        f"üë§ –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–≤–≤–µ–¥–µ–Ω–æ): {name}\n"
        f"üîó Telegram: @{tg_name}\n"
        f"üÜî Telegram ID: {user_id}\n"
        f"üìõ –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è: {full_name}\n"
        f"üìå –¢–∏–ø —Ä–µ–∫–ª–∞–º—ã: {ad_type}\n"
        f"üìù –û–ø–∏—Å–∞–Ω–∏–µ: {desc}"
    )

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ
    if message.content_type == "photo":
        photo_id = message.photo[-1].file_id
        bot.send_photo(admin_chat_id, photo_id, caption=text)
    else:
        bot.send_message(admin_chat_id, text)

    bot.send_message(chat_id, "–°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.")


# –ó–∞–ø—É—Å–∫
bot.remove_webhook()
bot.polling(none_stop=True)